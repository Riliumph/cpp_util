# singleton

## サンプル動かし方

- vscode上でF5でデバッグ実行する
  - `task.json`内にmakeを走らせるようにしている
- `make all`を実行する

## 動作解説

### 通常アクセスでは値は変わらない

`routine()`関数を用いて通常アクセスによる内部変数の更新を行う。  
このアクセスでは、インスタンスは「コピーされている」ため、値を変更しても他のインスタンスに影響しない。  
また、新しく取得したインスタンスの値も変更されていない。

### 参照アクセスでは値を変えられる。ただし、局所変数は追従しない

`ref_routine()`関数を用いて参照アクセスによる内部変数の更新を行う。  
このアクセスでは、インスタンスは「ポインタで取得されている」ため、値を変更すると他のインスタンスに影響する。  
ただし、すでにローカルメモリに確保した値に関しては、以前の状態でコピーされて繋がっていないため値は更新されない。  
しかし、新しく取得したインスタンスの値は変更されている。

### まとめ

局所変数として保存するとシングルトンとしての意味が薄れる気がする。  
都度、インスタンスを取得するようなコードが望ましい気がする。

## 参考

boost.Logの中にlazySingletonとSingletonがいるのでそっち使ったほうがいいかも。

```bash
cat /usr/include/boost/log/detail/singleton.hpp
```
